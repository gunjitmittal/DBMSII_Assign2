{% import "bootstrap/wtf.html" as wtf %}
{% include "header.html" %}

  <!-- Page Header -->
  <header class="masthead" style="background-image: url('https://images.unsplash.com/photo-1470092306007-055b6797ca72?ixlib=rb-1.2.1&auto=format&fit=crop&w=668&q=80')">
    <div class="overlay"></div>
    <div class="container">
      <div class="row">
        <div class="col-lg-8 col-md-10 mx-auto">
          <div class="site-heading">
            <h1>Gunjit's Blog</h1>
            <span class="subheading">A collection of random musings.</span>
            
            <form class='form-inline' method='GET'>
              <div class='form-group'>
                {{ form.autocomp.label }} {{ form.autocomp(class="form-control") }}
              </div>
              <div class="form-group">
                  {{ form.tag_autocomp.label }} {{ form.tag_autocomp(class="form-control") }}
              </div>
              <div class='form-group'> 
                {{ form.sortby(class="form-control") }}
              </div>
              <div class="form-group btn-secondary" style='border-radius=50%'>
                  {{ form.submit(class="btn btn-default") }}
              </div>
            </form>
          </div>
          
        </div>
        
      </div>
      
    </div>
  </header>

  <!-- Main Content -->
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-md-10 mx-auto">
       <!--{{ wtf.quick_form(form, novalidate=True, button_map={"submit": "primary"}) }}-->
        {% for post in all_posts.items %}
        <div class="post-preview">
          <a href="{{ url_for('show_post', post_id=post.id) }}">
            <h2 class="post-title">
              {{post.title}}
            </h2>
          <!--  <h3 class="post-subtitle">
              {{post.subtitle}}
            </h3> -->
          </a>
          <p class="post-meta">Posted by
            <a href="{{url_for('profile', id=post.owner_user_id)}}">{{post.owner_display_name}}</a>
            on {{post.creation_date.date()}} tag:{{post.tags.replace('<','').replace('>',',')[:-1]}}
            {% if current_user.id==post.owner_user_id %}
              <a href="{{url_for('delete_post', post_id=post.id) }}">âœ˜</a>
            {% endif %}
          </p>
        </div>
        <hr>
        {% endfor %}

        {% if all_posts.has_prev %}<a href="{{ url_for('get_all_posts', page=all_posts.prev_num, autocomp=args['autocomp'], tag_autocomp=args['tag_autocomp'], sortby=args['sortby']) }}">&lt;&lt; Previous page</a>{% endif %} | 
        {% if all_posts.has_next %}<a href="{{ url_for('get_all_posts', page=all_posts.next_num, autocomp=args['autocomp'], tag_autocomp=args['tag_autocomp'], sortby=args['sortby']) }}">Next Page &gt;&gt;</a>{% endif %}
        <!-- New Post -->
        {% if current_user.is_authenticated %}
          <div class="clearfix">
            <a class="btn btn-primary float-right" href="{{url_for('add_new_post')}}">Create New Post</a>
          </div>
        {% endif %}
      <script>
        $(function() {
          $("#autocomplete").autocomplete({
              minLength: 2,
              source:function(request, response) {
                  $.getJSON("{{url_for('autocomplete')}}",{
                      q: request.term,
                  }, function(data) {
                      response(data.matching_results); 
                  });
              },
              minLength: 1,
              select: function(event, ui) {
                  console.log(ui.item.value); 
              }
          });
      })
    </script>
    <script>
      $(function(){
        var defaultOpts = {
          keyLimit: 1,
          hide:false,
          freeInput:false,
          freeEdit:false,
        };
        $("#tag_autocomplete").tagComplete({ 	 	autocomplete:{ajaxOpts:{
						
          url: "{{url_for('tagcomplete')}}",
          },
          params: function(value){
						
            return {q:value};
          },
          proccessData: function(data){

            //return the data
            console.log(data);
           return data.matching_results;
        }//end proccess ajax data,
        
    
      }//end auto complete 
       });
       
    });
      </script>
      </div>
    </div>
  </div>
  <hr>

{% include "footer.html" %}